<!DOCTYPE html>
<html>
    <head>
        <title>Game test 02 - Mouse Event</title>
        <style type="text/css">
            *{
                margin:0;
                padding:0;
            }
            #screen{
                width:800px;
                height:600px;
                background:#FFF;              
                margin:0 auto;
                border: solid 2px #000;
            }
        </style>
    </head>
    <body>
        <canvas id="screen" width="800" height="600">
            <p>javascript desabilitado, ou navegador sem suporte.</p>
        </canvas>

        <script type="text/javascript">
        /**
        * Global vars
        */
         var score = 0;
         var level = 0;
         var clickTry = 10;
         var countClick = 0;
         var gameOver = false;
        </script>

        <script type="text/javascript">
            /**
            * Funções de Regras.
            * 
            */

            /**
            * Verifica a variavel score para definir o level
            * e aumentar a velocidado do player.
            */
            function checkLevel(obj)
            {                
                if (score % 5 == 0) {
                    level += 1;
                    if (obj.xSpd > 0)
                        obj.xSpd += 1;
                    else
                        obj.xSpd -= 1;

                    if (obj.ySpd > 0)
                        obj.ySpd += 1;
                    else
                        obj.ySpd -= 1;

                    console.log("xS: " + obj.ySpd + " - yS: " + obj.ySpd);
                }
            }

            /**
            * contabiliza os pontos incrementanto a variavel score
            */
            function countScore()
            {
                score += 1;                
            }
            
        </script>

        <script type="text/javascript">
            /**
            * Objeto Principal
            * 
            */
            var Player = {
                canvas  : null,
                context : null,
                name    : 'Player',
                img     : new Image(),
                x       : 100,
                y       : 100,
                w       : 98,
                h       : 96,
                xSpd    : 5,
                ySpd    : 5,
                collid  : false,
                canMove : true,
                create  : function(){
                   this.img.src ="img/image01.JPG";
                   this.context.drawImage(this.img, this.x, this.y)
                },
                move   : function(){
                    if (this.canMove) {
                        this.x += this.xSpd;
                        this.y += this.ySpd;

                        this.bounce(this.canvas);
                    }
                },
                bounce : function(element){
                    /**
                    * O bounce faz com que quando o objeto 'toque' nos limites da tela
                    * inverta o angulo do movimento.
                    */

                    // Se atingir s extremidades horizontal inverter o valor de X
                    if( (this.x >= element.w - this.w) || (this.x <= 0) ) {
                        this.xSpd *= -1;
                    }                    
                    // Se atingor as extremidades vertical inverter o valor de Y
                    if( (this.y >= element.h - this.h) || (this.y <= 0) ) {
                        this.ySpd *= -1;
                    }
                },

                mouseClick: function(){
                    this.canvas.onmousedown = this.mouseClickedAction;
                },

                mouseClickedAction: function(e){                    
                    if( (e.clientX >= Player.x && e.clientX <= Player.x+Player.w ) && (e.clientY >= Player.y && e.clientY <=Player.y+Player.h)) {
                        countScore();
                        checkLevel(Player);
                        
                        //Altera a posição X e Y para um valor random
                        Player.x = Math.floor((Math.random()*(Player.canvas.width-Player.w))+1);
                        Player.y = Math.floor((Math.random()*(Player.canvas.height-Player.h))+1);
                    }
                    else {
                        if (clickTry <= 1) {
                            gameOver= true;
                        }
                        clickTry -= 1;
                    }
                }

            };
        </script>

        <script type="text/javascript">
            var Texto = {
                context : null,
                text    : '',
                color   : '000',
                font    : 'Arial',
                size    : '20px',
                x       : 0,
                y       : 0,
                
                drawText: function(){
                    this.context.fillStyle = this.color;
                    this.context.font = this.size + " " + this.font;
                    this.context.fillText(this.text, this.x, this.y);
                } 
            };
        </script>

        <script type="text/javascript">
            ////canvas.onmousedown = getMouseDown;
            var gameEvents = {
                canvas  : null,

            };
        </script>
        
        <script>            
            // Define o elemento canvas
            var canvas = document.getElementById('screen');
            var context = canvas.getContext("2d");
            canvas.w = canvas.width;
            canvas.h = canvas.height;
            
            //Define o tamanho do canvas
            var canvasW = canvas.width;
            var canvasH = canvas.height;
            
            //Define o loop do game com 20 FPS (1000/20 = 50)
            var interval = window.setInterval('gameLoop()', 50); 

            /**
            * Define um novo Objeto do Player
            */
            Player.canvas = canvas;
            Player.context = context;
            var Obj1 = Player

            /**
            * Define um novo objeto do Texto
            */
            Texto.context = context;
            var ObjText1 = Texto;

            // Texto de GAME OVER
            var gameOver_text = Object.create(Texto);
            gameOver_text.text = "GAME OVER";
            gameOver_text.color = "FF0000";
            gameOver_text.size = "30px";
            gameOver_text.x = 300;
            gameOver_text.y = 300;
            

            function gameLoop()
            {                
                drawElements();                
            }          
            
            function drawElements()
            {
                //limpa o retangulo anterior do canvas
                context.clearRect(0,0, canvasW, canvasH);
                
                if (!gameOver){
                    /** 
                    * Executa as funções do Player
                    */
                    // Exibe o obejto na tela
                    Obj1.create();                
                    // Altera a posição
                    Obj1.move();
                    // Verifica se houve um click sobre o objto
                    Obj1.mouseClick();


                    /**
                    * Executa as funções do Texto
                    */
                    // Define o texto
                    ObjText1.text = "Points: " + score + " | level: " + level + " | Try: " + clickTry;                
                    // Define a posição
                    ObjText1.x = 250;
                    ObjText1.y = 20;
                    // Exibe o texto na tela.
                    ObjText1.drawText();
                }
                else {
                    gameOver_text.drawText();
                }
            }                        
        </script>

        
    </body>
</html>